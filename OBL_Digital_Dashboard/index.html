<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OBL Digital â€” Control Global MEX</title>
  <link rel="icon" type="image/png" href="logo.png" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet" />

  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background-color: #0d0d0d;
      color: #fff;
      height: 100vh;
      overflow: hidden;
    }
    .login-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      padding: 20px;
    }
    .login-container img {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      margin-bottom: 25px;
      box-shadow: 0 0 25px rgba(255, 170, 0, 0.7);
      transition: 0.4s ease;
    }
    .login-container input {
      width: 260px;
      margin: 8px 0;
      padding: 10px;
      border: 1px solid #D4AF37;
      border-radius: 8px;
      background-color: #1a1a1a;
      color: #fff;
      text-align: center;
    }
    .login-container button {
      background-color: #D4AF37;
      color: #000;
      font-weight: bold;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    }
    .hidden { display: none; }

    .dashboard { display: flex; height: 100vh; }
    .sidebar {
      width: 220px;
      background-color: #141414;
      border-right: 2px solid #D4AF37;
      padding-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .menu { list-style: none; padding: 0; width: 100%; }
    .menu li {
      padding: 12px 20px;
      cursor: pointer;
      color: #f2f2f2;
    }
    .menu li:hover {
      background-color: #D4AF37;
      color: #000;
      font-weight: bold;
    }

    .main { flex: 1; display: flex; flex-direction: column; }
    .topbar {
      height: 60px;
      background-color: #141414;
      border-bottom: 2px solid #D4AF37;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }
    section { flex: 1; display: none; }
    section.active { display: block; }
    iframe { width: 100%; height: 100%; border: none; }

    #logout-overlay {
      position: fixed;
      inset: 0;
      background: #0d0d0d;
      color: #D4AF37;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      visibility: hidden;
      z-index: 9999;
    }
    #logout-overlay.active { visibility: visible; }
  </style>
</head>

<body>

<!-- LOGIN -->
<div id="login-container" class="login-container">
  <img src="assets/logo.png">
  <input id="username" placeholder="Usuario">
  <input id="password" type="password" placeholder="ContraseÃ±a">
  <button onclick="login()">Ingresar</button>
  <p id="error-msg"></p>
</div>

<!-- DASHBOARD -->
<div id="dashboard-container" class="dashboard hidden">
  <div class="sidebar">
    <ul class="menu">
      <li onclick="mostrarSeccion('dep_ftd_dashboard')">ðŸ“Š DEP FTD</li>
      <li onclick="mostrarSeccion('dep_rtn_dashboard')">ðŸ“ˆ DEP RTN</li>
      <li onclick="mostrarSeccion('general_ltv_dashboard')">ðŸ’¹ LTV</li>
      <li onclick="mostrarSeccion('general_ltvrtn_dashboard')">ðŸ’¹ LTV RTN</li>
      <li onclick="mostrarSeccion('comisiones_dashboard')">ðŸ’° COMISIONES</li>
    </ul>
  </div>

  <div class="main">
    <div class="topbar">
      <button id="pdfBtn">ðŸ“„ PDF</button>
      <button onclick="logout()">ðŸšª Log Out</button>
    </div>

    <section id="dep_ftd_dashboard"><iframe src="https://obldigital-dashboard-2.onrender.com/"></iframe></section>
    <section id="dep_rtn_dashboard"><iframe src="https://obldigital-dashboard.onrender.com/"></iframe></section>
    <section id="general_ltv_dashboard"><iframe src="https://obldigital-dashboard-3.onrender.com/"></iframe></section>
    <section id="general_ltvrtn_dashboard"><iframe src="https://obldigitalltv-pt-2.onrender.com/"></iframe></section>
    <section id="comisiones_dashboard"><iframe src="https://comisiones-mx.onrender.com"></iframe></section>
  </div>
</div>

<div id="logout-overlay">Cerrando sesiÃ³n...</div>

<!-- PDF LIBS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const users = {
  "ADMIN@DASHBOARD.NEX": { password: "ADMIN32100", role: "all" },
  "LEADERSFTD@DASHBOARD.NEX": { password: "FTD32100", role: "ftd" },
  "LEADERSRTN@DASHBOARD.NEX": { password: "RTN32100", role: "rtn" },
  "LEADERLTV@DASHBOARD.NEX": { password: "LTV32100", role: "ltv" },
  "COMISIONES@DASHBOARD.NEX": { password: "COM32100", role: "com" }
};

function login() {
  const u = username.value.trim().toUpperCase();
  const p = password.value.trim();
  if (users[u] && users[u].password === p) {
    localStorage.setItem("user", u);
    showDashboard();
  } else error-msg.innerText = "Credenciales incorrectas";
}

function logout() {
  document.getElementById("logout-overlay").classList.add("active");
  setTimeout(() => {
    localStorage.clear();
    location.reload();
  }, 800);
}

function showDashboard() {
  const role = users[localStorage.getItem("user")].role;
  login-container.classList.add("hidden");
  dashboard-container.classList.remove("hidden");

  const items = {
    ftd: dep_ftd_dashboard,
    rtn: dep_rtn_dashboard,
    ltv: general_ltv_dashboard,
    ltvrtn: general_ltvrtn_dashboard,
    com: comisiones_dashboard
  };

  const access = {
    ftd: ["ftd", "ltv"],
    rtn: ["rtn", "ltv", "ltvrtn"],
    ltv: ["ltv", "ltvrtn"],
    com: ["com"],
    all: Object.keys(items)
  };

  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  access[role].forEach(k => items[k].style.display = "block");
  items[access[role][0]].classList.add("active");
}

function mostrarSeccion(id) {
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* PDF */
const overlay = document.createElement("div");
overlay.innerText = "â³ Generando PDF...";
Object.assign(overlay.style,{
  position:"fixed",inset:0,background:"rgba(0,0,0,.85)",
  color:"#D4AF37",display:"flex",alignItems:"center",
  justifyContent:"center",zIndex:9999,visibility:"hidden"
});
document.body.appendChild(overlay);

pdfBtn.onclick = () => {
  const iframe = document.querySelector("section.active iframe");
  overlay.style.visibility="visible";
  iframe.contentWindow.postMessage({ action:"capture_dashboard" },"*");
};

window.addEventListener("message",e=>{
  if(e.data.action!=="capture_image")return;
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF("l","pt","a4");
  pdf.addImage(e.data.img,"PNG",0,0,pdf.internal.pageSize.getWidth(),pdf.internal.pageSize.getHeight());
  pdf.save("OBL_Dashboard.pdf");
  overlay.style.visibility="hidden";
});
</script>

</body>
</html>
